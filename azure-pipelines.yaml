pool: Default

trigger:
  branches:
    include:
      - main

stages:
  - stage: Build
    displayName: Build and test
    jobs:
      - job: Install
        steps:
          - script: |
              echo "Hello"
              npm install
              npm run build
              npm test
          - publish: dist
            artifact: dist
  - stage: DeployDev
    displayName: Deploy to dev
    dependsOn: Build
    jobs:
      - job: Deploy
        steps:
          - download: current
            artifact: dist
          - script: |
              echo $(BASEPLATE_TOKEN)
              npx @baseplate-sdk/cli deploy test --environment dev --dir ../dist --entry joel-test.js --autoVersion
            env:
              BASEPLATE_TOKEN: $(BASEPLATE_TOKEN)